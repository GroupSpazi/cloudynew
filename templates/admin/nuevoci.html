{% extends "admin/dashboard_admin.html" %}


{% block content %}
<div class="main-panel">
    <div class="content-wrapper">
        <div class="row">
            <div class="col-lg-12 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Registro de Cliente Nuevo CI</h4>
                        <form method="post" action="{{ url_for('nuevoci') }}">

                            <div class="row">
                                <!-- Sección 1: Datos personales -->
                                <div class="col-md-6">
                                    <h5>Datos personales</h5>

                                    <!-- Campo de asignación -->
                                  <!-- Campo de asignación -->
<div class="form-group">
    <label for="assigned_to">Asignado para:</label>
    {% if current_user.role == 'vendedor' %}
        <input type="text" class="form-control" id="assigned_to" name="assigned_to" value="{{ current_user.usuario }}" readonly>
    {% else %}
    <select class="form-control" id="assigned_to" name="assigned_to">
        {% for vendedor in vendedores %}
            <option value="{{ vendedor[0] }}">{{ vendedor[0] }}</option>
        {% endfor %}
    </select>
    
    {% endif %}
</div>

                                    

                                    <div class="form-group">
                                        <label for="identificador">Identificador:</label>
                                        <input type="text" class="form-control" id="identificador" name="identificador" value="CI" readonly required>
                                    </div>
                                    
                                    
                                    <div class="form-group">
                                        <label for="nombre">Nombre:</label>
                                        <input type="text" class="form-control" id="nombre" name="nombre" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="apellido_paterno">Apellido Paterno:</label>
                                        <input type="text" class="form-control" id="apellido_paterno" name="apellido_paterno" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="apellido_materno">Apellido Materno:</label>
                                        <input type="text" class="form-control" id="apellido_materno" name="apellido_materno" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="fecha_nacimiento">Fecha de nacimiento:</label>
                                        <input type="date" class="form-control" id="fecha_nacimiento" name="fecha_nacimiento" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Sexo:</label><br>
                                        <input type="radio" id="masculino" name="sexo" value="masculino" required>
                                        <label for="masculino">Masculino</label><br>
                                        <input type="radio" id="femenino" name="sexo" value="femenino">
                                        <label for="femenino">Femenino</label>
                                    </div>
                                    <div class="form-group">
                                        <label for="curp">CURP:</label>
                                        <input type="text" class="form-control" id="curp" name="curp" required maxlength="18">
                                    </div>


<!-- Num. teléfono principal: -->

<style>
    .whatsapp-icon {
        font-size: 0.8rem; /* Ajusta el tamaño del ícono */
        padding: 7px 28px; /* Ajusta el padding del botón */
    }
</style>



<div class="form-group">
    <label for="telefono_principal">Num. teléfono principal con WhatsApp:</label>
    <div class="input-group">
        <input type="tel" class="form-control" id="telefono_principal" name="telefono_principal" required>
        
    </div>
</div>





                                </div>

                                <!-- Sección 2: Dirección Principal -->
                                <div class="col-md-6">
                                    <h5>Dirección principal de negocio</h5>
                                    <div class="form-group">
                                        <label for="codigo_postal">Código postal:</label>
                                        <input type="text" class="form-control" id="codigo_postal" name="codigo_postal" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="estado">Estado:</label>
                                        <input type="text" class="form-control" id="estado" name="estado" readonly required>
                                    </div>
                                    <div class="form-group">
                                        <label for="municipio">Municipio:</label>
                                        <input type="text" class="form-control" id="municipio" name="municipio" readonly required>
                                    </div>
                                    <div class="form-group">
                                        <label for="colonia">Colonia:</label>
                                        <select class="form-control" id="colonia" name="colonia"></select>
                                    </div>
                                    <div class="form-group">
                                        <label for="calle">Calle:</label>
                                        <input type="text" class="form-control" id="calle" name="calle" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="num_exterior">Núm. exterior:</label>
                                        <input type="text" class="form-control" id="num_exterior" name="num_exterior" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="num_interior">Núm. interior:</label>
                                        <input type="text" class="form-control" id="num_interior" name="num_interior">
                                    </div>
                                    <style>
                                        .btn-custom-size {
                                            padding: 6px 50px; /* Ajusta el padding para cambiar el tamaño del botón */
                                            font-size: 14px;   /* Ajusta el tamaño del texto dentro del botón */
                                        }
                                    </style>
                                    
                                    <div class="form-group">
                                        <label for="google_maps_url">Ubicación de Google Maps:</label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <button class="btn btn-inverse-primary btn-fw btn-custom-size" type="button" id="redirectToGoogleMaps"><i class="mdi mdi-apple-safari"></i></button>
                                            </div>
                                            <input type="text" class="form-control" id="google_maps_url" name="google_maps_url" readonly>
                                            <div class="input-group-append">
                                                <button class="btn btn-inverse-primary btn-fw btn-custom-size" type="button" id="copyGoogleMapsURL"><i class="mdi mdi-arrange-send-backward"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

<!-- Sección 3: Datos instalador -->
<div class="col-md-6">
    <h5>Datos instalador</h5>
    <div class="form-group">
        <label for="giro_instalador">Giro del instalador:</label>
        <select class="form-control" id="giro_instalador" name="giro_instalador" required>
            <option value="Instalador de puertas automaticas">Instalador de puertas automáticas</option>
            <option value="Herrero">Herrero</option>
            <option value="Soldador">Soldador</option>
            <option value="Aluminiero">Aluminiero</option>
        </select>
    </div>

    <div class="form-group">
        <label>¿Qué marcas compra?</label>
        <div class="custom-checkbox">
            <input class="form-check-input" type="checkbox" name="marcas_compra" value="Spazi" id="marca1">
            <label class="form-check-label" for="marca1">Spazi</label>
        </div>
        <div class="custom-checkbox">
            <input class="form-check-input" type="checkbox" name="marcas_compra" value="Seg" id="marca2">
            <label class="form-check-label" for="marca2">Seg</label>
        </div>
        <div class="custom-checkbox">
            <input class="form-check-input" type="checkbox" name="marcas_compra" value="Erreka" id="marca3">
            <label class="form-check-label" for="marca3">Erreka</label>
        </div>
        <div class="custom-checkbox">
            <input class="form-check-input" type="checkbox" name="marcas_compra" value="Merik" id="marca4">
            <label class="form-check-label" for="marca4">Merik</label>
        </div>
        <div class="custom-checkbox">
            <input class="form-check-input" type="checkbox" name="marcas_compra" value="Digiseg" id="marca5">
            <label class="form-check-label" for="marca5">Digiseg</label>
        </div>
        <div class="custom-checkbox">
            <input class="form-check-input" type="checkbox" name="marcas_compra" value="Ppa" id="marca6">
            <label class="form-check-label" for="marca6">Ppa</label>
        </div>
    </div>
</div>
</div>

                            <button type="submit" class="btn btn-primary">Guardar y Ver Perfil</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    document.getElementById("codigo_postal").addEventListener("input", function() {
        let cp = this.value;
        if (cp.length === 5) {
            fetch(`/get_info_by_cp/${cp}`)
            .then(response => response.json())
            .then(data => {
                document.getElementById("estado").value = data.estado;
                document.getElementById("municipio").value = data.municipio;
    
                let coloniaSelect = document.getElementById("colonia");
                coloniaSelect.innerHTML = ""; // Limpiar opciones anteriores
                data.colonias.forEach(colonia => {
                    let option = document.createElement("option");
                    option.text = colonia;
                    option.value = colonia;
                    coloniaSelect.add(option);
                });
            })
            .catch(error => {
                console.error("Hubo un error al obtener la información del CP:", error);
            });
        }
    });
    
    
</script>

<script> 
    function generateGoogleMapsURL() {
        let calle = document.getElementById("calle").value;
        let num_exterior = document.getElementById("num_exterior").value;
        let colonia = document.getElementById("colonia").value;
        let municipio = document.getElementById("municipio").value;
        let estado = document.getElementById("estado").value;
        let direccionCompleta = `${calle} ${num_exterior}, ${colonia}, ${municipio}, ${estado}`;
        
        let googleMapsURL = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(direccionCompleta)}`;
        document.getElementById("google_maps_url").value = googleMapsURL;
    }
    
    document.getElementById("codigo_postal").addEventListener("input", function() {
        // ... (tu código existente) ...
    
        // Llamar a la función para generar la URL de Google Maps
        generateGoogleMapsURL();
    });
    
    // También puedes llamar a la función cuando otros campos relevantes cambien:
    document.getElementById("calle").addEventListener("input", generateGoogleMapsURL);
    document.getElementById("num_exterior").addEventListener("input", generateGoogleMapsURL);
    document.getElementById("colonia").addEventListener("change", generateGoogleMapsURL);
    

    document.getElementById("copyGoogleMapsURL").addEventListener("click", function() {
        let googleMapsURLInput = document.getElementById("google_maps_url");
        googleMapsURLInput.select();
        document.execCommand("copy");
        alert("URL copiada al portapapeles");
    });
    
    document.getElementById("redirectToGoogleMaps").addEventListener("click", function() {
        let googleMapsURL = document.getElementById("google_maps_url").value;
        window.open(googleMapsURL, '_blank');
    });
    


</script>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const whatsappButtons = document.querySelectorAll('.whatsapp-icon');
        whatsappButtons.forEach(btn => {
            btn.addEventListener('click', function(event) {
                event.preventDefault(); // Evitar que el botón envíe el formulario
                if (this.classList.contains('btn-inverse-dark')) {
                    this.classList.remove('btn-inverse-dark');
                    this.classList.add('btn-inverse-success');
                    // Aquí puedes agregar lógica adicional para guardar el estado "Sí" en la BD
                } else {
                    this.classList.remove('btn-inverse-success');
                    this.classList.add('btn-inverse-dark');
                    // Aquí puedes agregar lógica adicional para guardar el estado "No" en la BD
                }
            });
        });
    });
</script>



{% endblock %}
